<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Календарь</title>
    <base href="/" />

    <link rel="stylesheet" href="css/app.css" />

    <link rel="icon" type="image/svg+xml" href="calendar-icon.svg" />

    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="scripts.js"></script>

    <style>
        /* Анимация вращения круга */
        .spin-slow {
            animation: spin 2s linear infinite;
        }
    </style>

</head>

<body>
    <!-- Экран загрузки -->
    <div id="loading-container" class="min-h-screen flex items-center justify-center">
        <div class="flex flex-col items-center justify-center bg-white bg-opacity-80 rounded-xl p-8 shadow-lg">
            <!-- Круговой индикатор -->
            <div class="relative w-24 h-24 mb-4">
                <svg class="w-24 h-24 transform -rotate-90" viewBox="0 0 100 100">
                    <!-- Фон круга -->
                    <circle cx="50" cy="50" r="45" stroke="#e5e7eb" stroke-width="10" fill="none" />
                    <!-- Прогресс -->
                    <circle id="progress-circle" cx="50" cy="50" r="45" stroke="#3b82f6" stroke-width="10" fill="none"
                            stroke-linecap="round" stroke-dasharray="282.6" stroke-dashoffset="282.6" />
                </svg>
            </div>
            <!-- Текст загрузки -->
            <div id="loading-text" class="text-gray-800 font-semibold text-lg">Загрузка приложения...</div>
        </div>
    </div>

    <!-- Основное приложение -->
    <div id="app" class="hidden"></div>

    <script src="_framework/blazor.webassembly.js"></script>
    <script>
        const loadingContainer = document.getElementById('loading-container');
        const text = document.getElementById("loading-text");

        // Устанавливаем градиент в зависимости от темы
        const theme = localStorage.getItem('theme'); // "dark" или другое
        if (theme === 'dark') {
            loadingContainer.classList.add('bg-gradient-conic-dark');
        } else {
            loadingContainer.classList.add('bg-gradient-conic-light');
        }

        const circle = document.getElementById("progress-circle");
        const radius = 45;
        const circumference = 2 * Math.PI * radius;

        function setProgress(percent) {
            const offset = circumference - (percent / 100) * circumference;
            circle.style.strokeDashoffset = offset;
        }

        let progress = 0;
        let blazorLoaded = false;

        function updateProgress() {
            if (progress < 80) {
                progress += Math.random() * 3;
                text.innerText = `Загрузка приложения... ${Math.floor(progress)}%`;
                setProgress(progress);
                requestAnimationFrame(updateProgress);
            } else if (blazorLoaded) {
                progress = 100;
                text.innerText = `Загрузка приложения... 100%`;
                setProgress(progress);
                setTimeout(() => {
                    loadingContainer.style.display = "none";
                    document.getElementById("app").classList.remove("hidden");
                }, 300);
            } else {
                requestAnimationFrame(updateProgress);
            }
        }

        updateProgress();

        window.addEventListener('load', () => {
            blazorLoaded = true;
        });

    </script>

</body>

</html>
